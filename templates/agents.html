<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agents - Xpanel</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard_ultra.css') }}">
    <script src="{{ url_for('static', filename='js/auth.js') }}"></script>
    <script src="{{ url_for('static', filename='js/agents.js') }}"></script>
</head>
<body>
    <div class="app">
        <aside class="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <div class="logo-icon"><i class="fas fa-cube"></i></div>
                    <div class="logo-text">Xpanel</div>
                </div>
            </div>
            <nav class="nav-menu">
                <div class="nav-section">
                    <div class="nav-item" onclick="window.location.href='/dashboard'">
                        <div class="nav-icon"><i class="fas fa-tachometer-alt"></i></div>
                        <div class="nav-text">Dashboard</div>
                    </div>
                    <div class="nav-item" onclick="window.location.href='/servers'">
                        <div class="nav-icon"><i class="fas fa-server"></i></div>
                        <div class="nav-text">Servers</div>
                    </div>
                    <div class="nav-item" onclick="window.location.href='/terminal'">
                        <div class="nav-icon"><i class="fas fa-terminal"></i></div>
                        <div class="nav-text">Terminal</div>
                    </div>
                    <div class="nav-item" onclick="window.location.href='/analytics'">
                        <div class="nav-icon"><i class="fas fa-chart-line"></i></div>
                        <div class="nav-text">Analytics</div>
                    </div>
                </div>
                <div class="nav-section">
                    <div class="nav-item active">
                        <div class="nav-icon"><i class="fas fa-download"></i></div>
                        <div class="nav-text">Agents</div>
                        <div class="nav-indicator"></div>
                    </div>
                    <div class="nav-item" onclick="window.location.href='/security'">
                        <div class="nav-icon"><i class="fas fa-shield-alt"></i></div>
                        <div class="nav-text">Security</div>
                    </div>
                    <div class="nav-item" onclick="window.location.href='/settings'">
                        <div class="nav-icon"><i class="fas fa-cog"></i></div>
                        <div class="nav-text">Settings</div>
                    </div>
                </div>
            </nav>
            <div class="sidebar-footer">
                <div class="user-profile">
                    <div class="user-avatar"><i class="fas fa-user"></i></div>
                    <div class="user-info">
                        <div class="user-name">Admin</div>
                        <div class="user-status">Online</div>
                    </div>
                    <button class="logout-btn" onclick="window.location.href='/login'">
                        <i class="fas fa-sign-out-alt"></i>
                    </button>
                </div>
            </div>
        </aside>
        
        <main class="main">
            <header class="header">
                <div class="header-content">
                    <div class="page-info">
                        <div class="page-title">
                            <div class="title-icon"><i class="fas fa-download"></i></div>
                            Agents
                        </div>
                        <div class="page-description">Manage VPS monitoring agents</div>
                    </div>
                </div>
            </header>
            
            <div class="content">
                <!-- Agents Controls -->
                <div class="agents-controls">
                    <div class="controls-left">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="agentSearch" placeholder="Поиск агентов...">
                        </div>
                        <div class="filter-dropdown">
                            <select id="statusFilter">
                                <option value="all">Все статусы</option>
                                <option value="online">Онлайн</option>
                                <option value="offline">Оффлайн</option>
                                <option value="error">Ошибка</option>
                                <option value="updating">Обновление</option>
                            </select>
                        </div>
                    </div>
                    <div class="controls-right">
                        <button class="btn-secondary" id="refreshAgents">
                            <i class="fas fa-sync-alt"></i>
                            Обновить
                        </button>
                        <button class="btn-primary" id="installNewAgent">
                            <i class="fas fa-plus"></i>
                            Установить агент
                        </button>
                    </div>
                </div>

                <!-- Agents Stats -->
                <div class="agents-stats">
                    <div class="stat-card">
                        <div class="stat-icon online">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="onlineAgents">0</div>
                            <div class="stat-label">Онлайн</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon offline">
                            <i class="fas fa-times-circle"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="offlineAgents">0</div>
                            <div class="stat-label">Оффлайн</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon total">
                            <i class="fas fa-server"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="totalAgents">0</div>
                            <div class="stat-label">Всего</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon version">
                            <i class="fas fa-code-branch"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="latestVersion">v2.1.0</div>
                            <div class="stat-label">Последняя версия</div>
                        </div>
                    </div>
                </div>

                <!-- Agents Grid -->
                <div class="agents-grid" id="agentsGrid">
                    <!-- Agents will be loaded here -->
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <div class="empty-icon"><i class="fas fa-robot"></i></div>
                    <div class="empty-title">Нет установленных агентов</div>
                    <div class="empty-description">Установите агенты на ваши серверы для мониторинга и управления</div>
                    <button class="btn-primary" id="installFirstAgent">
                        <i class="fas fa-download"></i>
                        Установить первый агент
                    </button>
                </div>
            </div>

            <!-- Install Agent Modal -->
            <div class="modal" id="installAgentModal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h3><i class="fas fa-download"></i> Установка агента</h3>
                        <button class="modal-close" id="closeInstallModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="install-steps">
                            <div class="step active" data-step="1">
                                <div class="step-number">1</div>
                                <div class="step-content">
                                    <h4>Выберите сервер</h4>
                                    <select id="serverSelect" class="form-input">
                                        <option value="">Выберите сервер...</option>
                                    </select>
                                    <div class="step-description">
                                        Выберите сервер для установки агента мониторинга
                                    </div>
                                </div>
                            </div>
                            <div class="step" data-step="2">
                                <div class="step-number">2</div>
                                <div class="step-content">
                                    <h4>Данные для подключения</h4>
                                    <div class="form-group">
                                        <label>IP адрес</label>
                                        <input type="text" id="serverHost" class="form-input" placeholder="192.168.1.100">
                                    </div>
                                    <div class="form-row">
                                        <div class="form-group">
                                            <label>Порт SSH</label>
                                            <input type="number" id="serverPort" class="form-input" value="22">
                                        </div>
                                        <div class="form-group">
                                            <label>Пользователь</label>
                                            <input type="text" id="serverUser" class="form-input" placeholder="root">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Пароль</label>
                                        <input type="password" id="serverPassword" class="form-input" placeholder="Пароль SSH">
                                    </div>
                                </div>
                            </div>
                            <div class="step" data-step="3">
                                <div class="step-number">3</div>
                                <div class="step-content">
                                    <h4>Установка</h4>
                                    <div class="install-progress">
                                        <div class="progress-bar">
                                            <div class="progress-fill" id="installProgress"></div>
                                        </div>
                                        <div class="progress-text" id="installProgressText">Готов к установке</div>
                                    </div>
                                    <div class="install-console" id="installConsole">
                                        <div class="console-header">
                                            <span>Консоль установки</span>
                                            <button class="console-clear" id="clearConsole">
                                                <i class="fas fa-trash"></i>
                                            </button>
                                        </div>
                                        <div class="console-output" id="consoleOutput">
                                            <div class="console-line info">Готов к началу установки агента...</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button class="btn-secondary" id="prevStep">Назад</button>
                        <button class="btn-primary" id="nextStep">Далее</button>
                        <button class="btn-success" id="startInstall" style="display: none;">Установить</button>
                        <button class="btn-secondary" id="finishInstall" style="display: none;">Готово</button>
                    </div>
                </div>
            </div>

            <!-- Agent Details Modal -->
            <div class="modal" id="agentDetailsModal">
                <div class="modal-content large">
                    <div class="modal-header">
                        <h3><i class="fas fa-info-circle"></i> Детали агента</h3>
                        <button class="modal-close" id="closeDetailsModal">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    <div class="modal-body">
                        <div class="agent-details-content" id="agentDetailsContent">
                            <!-- Agent details will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>
</body>
</html>
